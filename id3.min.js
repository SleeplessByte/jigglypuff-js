!function(){var e=function(t){this.type=t||e.OPEN_URI,this.size=null,this.file=null};if(e.OPEN_FILE=1,e.OPEN_URI=2,e.OPEN_LOCAL=3,"function"==typeof require)var t=require("fs");e.prototype.open=function(i,n){this.file=i;var r=this;switch(this.type){case e.OPEN_LOCAL:t.stat(this.file,function(e,i){return e?n(e):(r.size=i.size,void t.open(r.file,"r",function(e,t){return e?n(e):(r.fd=t,void n())}))});break;case e.OPEN_FILE:this.size=this.file.size,n();break;default:this.ajax({uri:this.file,type:"HEAD"},function(e,t,i){return e?n(e):(r.size=parseInt(i.getResponseHeader("Content-Length")),void n())})}},e.prototype.close=function(){this.type===e.OPEN_LOCAL&&t.close(this.fd)},e.prototype.read=function(t,i,n){"function"==typeof i&&(n=i,i=0),this.type===e.OPEN_LOCAL?this.readLocal(t,i,n):this.type===e.OPEN_FILE?this.readFile(t,i,n):this.readUri(t,i,n)},e.prototype.readBlob=function(e,t,i,n){"function"==typeof t?(n=t,t=0):"function"==typeof i&&(n=i,i="application/octet-stream"),this.read(e,t,function(e,t){return e?void n(e):void n(null,new Blob([t],{type:i}))})},e.prototype.readLocal=function(e,i,n){var r=new Buffer(e);t.read(this.fd,r,0,e,i,function(e,t,i){if(e)return n(e);for(var r=new ArrayBuffer(i.length),a=new Uint8Array(r),o=0;o<i.length;o++)a[o]=i[o];n(null,r)})},e.prototype.ajax=function(e,t){var i={type:"GET",uri:null,responseType:"text"};"string"==typeof e&&(e={uri:e});for(var n in e)i[n]=e[n];var r=new XMLHttpRequest;r.onreadystatechange=function(){return 4===r.readyState?200!==r.status&&206!==r.status?t("Received non-200/206 response ("+r.status+")"):void t(null,r.response,r):void 0},r.responseType=i.responseType,r.open(i.type,i.uri,!0),i.range&&(i.range=[].concat(i.range),2===i.range.length?r.setRequestHeader("Range","bytes="+i.range[0]+"-"+i.range[1]):r.setRequestHeader("Range","bytes="+i.range[0])),r.send()},e.prototype.readUri=function(e,t,i){this.ajax({uri:this.file,type:"GET",responseType:"arraybuffer",range:[t,t+e-1]},function(e,t){return e?i(e):i(null,t)})},e.prototype.readFile=function(e,t,i){var n=this.file.slice(t,t+e),r=new FileReader;r.onload=function(e){i(null,e.target.result)},r.onerror=function(e){i("File read failed")},r.readAsArrayBuffer(n)},DataView.prototype.getString=function(e,t,i){t=t||0,e=e||this.byteLength-t,0>e&&(e+=this.byteLength);var n="";if("undefined"!=typeof Buffer){for(var r=[],a=t;t+e>a;a++)r.push(this.getUint8(a));return new Buffer(r).toString()}for(var a=t;t+e>a;a++)n+=String.fromCharCode(this.getUint8(a));return i?n:decodeURIComponent(escape(n))},DataView.prototype.getStringUtf16=function(e,t,i){t=t||0,e=e||this.byteLength-t;var n=!1,r="",a=!1;if("undefined"!=typeof Buffer&&(r=[],a=!0),0>e&&(e+=this.byteLength),i){var o=this.getUint16(t);65534===o&&(n=!0),t+=2,e-=2}for(var l=t;t+e>l;l+=2){var s=this.getUint16(l,n);s>=0&&55295>=s||s>=57344&&65535>=s?a?r.push(s):r+=String.fromCharCode(s):s>=65536&&1114111>=s&&(s-=65536,a?(r.push(((1047552&s)>>10)+55296),r.push((1023&s)+56320)):r+=String.fromCharCode(((1047552&s)>>10)+55296)+String.fromCharCode((1023&s)+56320))}return a?new Buffer(r).toString():decodeURIComponent(escape(r))},DataView.prototype.getSynch=function(e){for(var t=0,i=2130706432;i;)t>>=1,t|=e&i,i>>=8;return t},DataView.prototype.getUint8Synch=function(e){return this.getSynch(this.getUint8(e))},DataView.prototype.getUint32Synch=function(e){return this.getSynch(this.getUint32(e))},DataView.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)};var i=function(t,n){var r={type:i.OPEN_URI};"string"==typeof t?t={file:t,type:i.OPEN_URI}:"undefined"!=typeof window&&window.File&&t instanceof window.File&&(t={file:t,type:i.OPEN_FILE});for(var a in t)r[a]=t[a];if(!r.file)return n("No file was set");if(r.type===i.OPEN_FILE){if("undefined"==typeof window||!window.File||!window.FileReader||"undefined"==typeof ArrayBuffer)return n("Browser does not have support for the File API and/or ArrayBuffers")}else if(r.type===i.OPEN_LOCAL&&"function"!=typeof require)return n("Local paths may not be read within a browser");var o=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop / Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast  Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Rock/Pop"],l={};l.types={TALB:"album",TBPM:"bpm",TCOM:"composer",TCON:"genre",TCOP:"copyright",TDEN:"encoding-time",TDLY:"playlist-delay",TDOR:"original-release-time",TDRC:"recording-time",TDRL:"release-time",TDTG:"tagging-time",TENC:"encoder",TEXT:"writer",TFLT:"file-type",TIPL:"involved-people",TIT1:"content-group",TIT2:"title",TIT3:"subtitle",TKEY:"initial-key",TLAN:"language",TLEN:"length",TMCL:"credits",TMED:"media-type",TMOO:"mood",TOAL:"original-album",TOFN:"original-filename",TOLY:"original-writer",TOPE:"original-artist",TOWN:"owner",TPE1:"artist",TPE2:"band",TPE3:"conductor",TPE4:"remixer",TPOS:"set-part",TPRO:"produced-notice",TPUB:"publisher",TRCK:"track",TRSN:"radio-name",TRSO:"radio-owner",TSOA:"album-sort",TSOP:"performer-sort",TSOT:"title-sort",TSRC:"isrc",TSSE:"encoder-settings",TSST:"set-subtitle",TAL:"album",TBP:"bpm",TCM:"composer",TCO:"genre",TCR:"copyright",TDY:"playlist-delay",TEN:"encoder",TFT:"file-type",TKE:"initial-key",TLA:"language",TLE:"length",TMT:"media-type",TOA:"original-artist",TOF:"original-filename",TOL:"original-writer",TOT:"original-album",TP1:"artist",TP2:"band",TP3:"conductor",TP4:"remixer",TPA:"set-part",TPB:"publisher",TRC:"isrc",TRK:"track",TSS:"encoder-settings",TT1:"content-group",TT2:"title",TT3:"subtitle",TXT:"writer",WCOM:"url-commercial",WCOP:"url-legal",WOAF:"url-file",WOAR:"url-artist",WOAS:"url-source",WORS:"url-radio",WPAY:"url-payment",WPUB:"url-publisher",WAF:"url-file",WAR:"url-artist",WAS:"url-source",WCM:"url-commercial",WCP:"url-copyright",WPB:"url-publisher",COMM:"comments",APIC:"image",PIC:"image"},l.imageTypes=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"],l.parse=function(e,t,i){i=i||0,t=t||4;var n={tag:null,value:null},r=new DataView(e);if(3>t)return l.parseLegacy(e);var a={id:r.getString(4),type:r.getString(1),size:r.getUint32Synch(4),flags:[r.getUint8(8),r.getUint8(9)]};if(0!==a.flags[1])return!1;if(!a.id in l.types)return!1;if(n.tag=l.types[a.id],"T"===a.type){var s=r.getUint8(10);if(0===s||3===s)n.value=r.getString(-11,11);else if(1===s)n.value=r.getStringUtf16(-11,11,!0);else{if(2!==s)return!1;n.value=r.getStringUtf16(-11,11)}"TCON"===a.id&&parseInt(n.value)&&(n.value=o[parseInt(n.value)])}else if("W"===a.type)n.value=r.getString(-10,10);else if("COMM"===a.id){for(var s=r.getUint8(10),u=14,g=0,c=u;;c++)if(1===s||2===s){if(0===r.getUint16(c)){u=c+2;break}c++}else if(0===r.getUint8(c)){u=c+1;break}if(0===s||3===s)n.value=r.getString(-1*u,u);else if(1===s)n.value=r.getStringUtf16(-1*u,u,!0);else{if(2!==s)return!1;n.value=r.getStringUtf16(-1*u,u)}}else if("APIC"===a.id){for(var s=r.getUint8(10),p={type:null,mime:null,description:null,data:null},u=11,g=0,c=u;;c++)if(0===r.getUint8(c)){g=c-u;break}p.mime=r.getString(g,u),p.type=l.imageTypes[r.getUint8(u+g+1)]||"other",u+=g+2,g=0;for(var c=u;;c++)if(0===r.getUint8(c)){g=c-u;break}p.description=0===g?null:r.getString(g,u),p.data=e.slice(u+1),n.value=p}return n.tag?n:!1},l.parseLegacy=function(e){var t={tag:null,value:null},i=new DataView(e),n={id:i.getString(3),type:i.getString(1),size:i.getUint24(3)};if(!n.id in l.types)return!1;if(t.tag=l.types[n.id],"T"===n.type){i.getUint8(7);t.value=i.getString(-7,7),"TCO"===n.id&&parseInt(t.value)&&(t.value=o[parseInt(t.value)])}else if("W"===n.type)t.value=i.getString(-7,7);else if("COM"===n.id){i.getUint8(6);t.value=i.getString(-10,10),-1!==t.value.indexOf("\x00")&&(t.value=t.value.substr(t.value.indexOf("\x00")+1))}else if("PIC"===n.id){var r=(i.getUint8(6),{type:null,mime:"image/"+i.getString(3,7).toLowerCase(),description:null,data:null});r.type=l.imageTypes[i.getUint8(11)]||"other";for(var a=11,s=0,u=a;;u++)if(0===i.getUint8(u)){s=u-a;break}r.description=0===s?null:i.getString(s,a),r.data=e.slice(a+1),t.value=r}return t.tag?t:!1};var s={};s.parse=function(e,t){var i={title:null,album:null,artist:null,year:null,v1:{title:null,artist:null,album:null,year:null,comment:null,track:null,version:1},v2:{version:[null,null]}},n={v1:!1,v2:!1},r=function(e){n.v1&&n.v2&&(i.title=i.v2.title||i.v1.title,i.album=i.v2.album||i.v1.album,i.artist=i.v2.artist||i.v1.artist,i.year=i.v1.year,t(e,i))};e.read(128,e.size-128,function(e,t){if(e)return r("Could not read file");var a=new DataView(t);return 128!==t.byteLength||"TAG"!==a.getString(3,null,!0)?(n.v1=!0,r()):(i.v1.title=a.getString(30,3).replace(/(^\s+|\s+$)/,"")||null,i.v1.artist=a.getString(30,33).replace(/(^\s+|\s+$)/,"")||null,i.v1.album=a.getString(30,63).replace(/(^\s+|\s+$)/,"")||null,i.v1.year=a.getString(4,93).replace(/(^\s+|\s+$)/,"")||null,0===a.getUint8(125)?(i.v1.comment=a.getString(28,97).replace(/(^\s+|\s+$)/,""),i.v1.version=1.1,i.v1.track=a.getUint8(126)):i.v1.comment=a.getString(30,97).replace(/(^\s+|\s+$)/,""),i.v1.genre=o[a.getUint8(127)]||null,n.v1=!0,void r())}),e.read(14,0,function(t,a){if(t)return r("Could not read file");var o,s=new DataView(a),u=10,g=0;return 14!==a.byteLength||"ID3"!==s.getString(3,null,!0)||s.getUint8(3)>4?(n.v2=!0,r()):(i.v2.version=[s.getUint8(3),s.getUint8(4)],o=s.getUint8(5),0!==(128&o)?(n.v2=!0,r()):(0!==(64&o)&&(u+=s.getUint32Synch(11)),g+=s.getUint32Synch(6),void e.read(g,u,function(e,t){if(e)return n.v2=!0,r();for(var a=new DataView(t),o=0;o<t.byteLength;){for(var s,u,g,c=!0,p=0;3>p;p++)g=a.getUint8(o+p),(65>g||g>90)&&(48>g||g>57)&&(c=!1);if(!c)break;u=i.v2.version[0]<3?t.slice(o,o+6+a.getUint24(o+3)):t.slice(o,o+10+a.getUint32Synch(o+4)),s=l.parse(u,i.v2.version[0]),s&&(i.v2[s.tag]=s.value),o+=u.byteLength}n.v2=!0,r()})))})};var u=new e(r.type);u.open(r.file,function(e){return e?n("Could not open specified file"):void s.parse(u,function(e,t){n(e,t),u.close()})})};i.OPEN_FILE=e.OPEN_FILE,i.OPEN_URI=e.OPEN_URI,i.OPEN_LOCAL=e.OPEN_LOCAL,"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("id3",[],function(){return i}):window.id3=i}();
